æˆ‘ä¸ºä½ æ•´ç†äº†ä¸€å¥—**åŒ…å«L1-L4å…¨åŠŸèƒ½ã€å¯ç›´æ¥å¤åˆ¶è¿è¡Œã€æ— çŸ­ä¿¡ä»…é‚®ä»¶æé†’**çš„ä¸‡å¹´å†å°ç¨‹åºå®Œæ•´ä»£ç åŒ…ï¼Œè¦†ç›–æ—¥å†ã€é»„å†ã€ç­¾åˆ°ç§¯åˆ†ã€æ‰“å¡ã€å…±äº«æ—¥å†ã€æ¡Œé¢å°ç»„ä»¶ã€å¤©æ°”ã€é‚®ä»¶æé†’ã€äº‘åŒæ­¥ç­‰æ‰€æœ‰åŠŸèƒ½ï¼Œä½ åªéœ€æ›¿æ¢å°‘é‡é…ç½®ï¼ˆäº‘ç¯å¢ƒIDã€QQé‚®ç®±ä¿¡æ¯ï¼‰å³å¯ç›´æ¥è·‘é€šå¹¶å‘å¸ƒã€‚

### æ ¸å¿ƒè¯´æ˜
1. ä»£ç åŸºäº**å¾®ä¿¡å°ç¨‹åºåŸç”Ÿ + äº‘å¼€å‘å…è´¹ç‰ˆ**ï¼Œä¸ªäººä¸»ä½“å¯ç›´æ¥ä½¿ç”¨ï¼›
2. å·²å°è£…æ‰€æœ‰æ ¸å¿ƒé€»è¾‘ï¼Œæ— å†—ä½™ä»£ç ï¼Œæ³¨é‡Šæ¸…æ™°ï¼Œæ–°æ‰‹ä¹Ÿèƒ½çœ‹æ‡‚ï¼›
3. æ‰€æœ‰åŠŸèƒ½æ— éœ€ä»˜è´¹æ¥å£ã€æ— éœ€ä¼ä¸šèµ„è´¨ï¼Œå…¨ç¨‹é›¶æˆæœ¬ã€‚

---

## ç¬¬ä¸€æ­¥ï¼šå®Œæ•´æ–‡ä»¶ç»“æ„ï¼ˆå…ˆåˆ›å»ºå¯¹åº”æ–‡ä»¶å¤¹/æ–‡ä»¶ï¼‰
```
â”œâ”€â”€ cloudfunctions/
â”‚   â”œâ”€â”€ sendEmail/           # é‚®ä»¶å‘é€äº‘å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”œâ”€â”€ timerRemind/         # å®šæ—¶æé†’äº‘å‡½æ•°
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”œâ”€â”€ signIn/              # ç­¾åˆ°ç§¯åˆ†äº‘å‡½æ•°
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â””â”€â”€ shareCalendar/       # å…±äº«æ—¥å†äº‘å‡½æ•°
â”‚       â””â”€â”€ index.js
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ index/               # é¦–é¡µï¼ˆæ—¥å†+é»„å†+å¤©æ°”+ä¸€è¨€ï¼‰
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â”œâ”€â”€ index.json
â”‚   â”‚   â”œâ”€â”€ index.wxml
â”‚   â”‚   â””â”€â”€ index.wxss
â”‚   â”œâ”€â”€ schedule/            # æ—¥ç¨‹æé†’ï¼ˆé‚®ä»¶+å¾®ä¿¡ï¼‰
â”‚   â”‚   â”œâ”€â”€ schedule.js
â”‚   â”‚   â”œâ”€â”€ schedule.json
â”‚   â”‚   â”œâ”€â”€ schedule.wxml
â”‚   â”‚   â””â”€â”€ schedule.wxss
â”‚   â”œâ”€â”€ punch/               # æ‰“å¡é¡µé¢
â”‚   â”‚   â”œâ”€â”€ punch.js
â”‚   â”‚   â”œâ”€â”€ punch.json
â”‚   â”‚   â”œâ”€â”€ punch.wxml
â”‚   â”‚   â””â”€â”€ punch.wxss
â”‚   â”œâ”€â”€ share/               # å…±äº«æ—¥å†
â”‚   â”‚   â”œâ”€â”€ share.js
â”‚   â”‚   â”œâ”€â”€ share.json
â”‚   â”‚   â”œâ”€â”€ share.wxml
â”‚   â”‚   â””â”€â”€ share.wxss
â”‚   â”œâ”€â”€ tools/               # å®ç”¨å°å·¥å…·
â”‚   â”‚   â”œâ”€â”€ tools.js
â”‚   â”‚   â”œâ”€â”€ tools.json
â”‚   â”‚   â”œâ”€â”€ tools.wxml
â”‚   â”‚   â””â”€â”€ tools.wxss
â”‚   â””â”€â”€ mine/                # æˆ‘çš„ï¼ˆç­¾åˆ°+ç§¯åˆ†+é‚®ç®±ç»‘å®šï¼‰
â”‚       â”œâ”€â”€ mine.js
â”‚       â”œâ”€â”€ mine.json
â”‚       â”œâ”€â”€ mine.wxml
â”‚       â””â”€â”€ mine.wxss
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ dateUtil.js          # å…¬å†/å†œå†/é»„å†/å†å²ä¸Šçš„ä»Šå¤©
â”‚   â”œâ”€â”€ dbUtil.js            # äº‘æ•°æ®åº“å°è£…
â”‚   â”œâ”€â”€ weatherUtil.js       # å¤©æ°”æ¥å£å°è£…
â”‚   â”œâ”€â”€ shareUtil.js         # åˆ†äº«å›¾ç”Ÿæˆ
â”‚   â””â”€â”€ starUtil.js          # æ˜Ÿåº§è¿åŠ¿
â”œâ”€â”€ static/                  # é™æ€èµ„æºï¼ˆå¯å…ˆåˆ›å»ºç©ºæ–‡ä»¶å¤¹ï¼‰
â”‚   â””â”€â”€ icon/                # å›¾æ ‡ï¼ˆå¯åç»­æ›¿æ¢ï¼‰
â”œâ”€â”€ app.js
â”œâ”€â”€ app.json
â”œâ”€â”€ app.wxss
â””â”€â”€ project.config.json      # é¡¹ç›®é…ç½®ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
```

---

## ç¬¬äºŒæ­¥ï¼šå…¨åŠŸèƒ½ä»£ç ï¼ˆé€ä¸ªæ–‡ä»¶å¤åˆ¶ï¼‰

### ä¸€ã€å…¨å±€é…ç½®æ–‡ä»¶
#### app.jsï¼ˆåˆå§‹åŒ–äº‘å¼€å‘+å…¨å±€æ•°æ®ï¼‰
```js
App({
  onLaunch() {
    // åˆå§‹åŒ–äº‘å¼€å‘
    if (!wx.cloud) {
      console.error('è¯·å‡çº§å¾®ä¿¡å¼€å‘è€…å·¥å…·åˆ°2.2.3ä»¥ä¸Šç‰ˆæœ¬');
    } else {
      wx.cloud.init({
        env: "ä½ çš„äº‘ç¯å¢ƒID", // æ›¿æ¢ä¸ºä½ çš„äº‘ç¯å¢ƒIDï¼ï¼ï¼
        traceUser: true,
      });
    }

    // è·å–ç”¨æˆ·OpenIDï¼ˆå…¨å±€å¯ç”¨ï¼‰
    this.getOpenId();

    // å…¨å±€æ•°æ®
    this.globalData = {
      userInfo: null,
      openId: '',
      userScore: 0 // ç”¨æˆ·ç§¯åˆ†
    };
  },

  // è·å–ç”¨æˆ·OpenID
  getOpenId() {
    wx.cloud.callFunction({
      name: 'login',
      data: {},
      success: res => {
        this.globalData.openId = res.result.openid;
      }
    });
  },

  // è·å–ç”¨æˆ·ç§¯åˆ†
  getUserScore(callback) {
    const db = wx.cloud.database();
    db.collection('users').where({
      _openid: this.globalData.openId
    }).get().then(res => {
      if (res.data.length > 0) {
        this.globalData.userScore = res.data[0].score || 0;
      } else {
        // åˆå§‹åŒ–ç”¨æˆ·ç§¯åˆ†
        db.collection('users').add({
          data: {
            score: 0,
            lastSignDate: '',
            createTime: db.serverDate()
          }
        }).then(() => {
          this.globalData.userScore = 0;
        });
      }
      callback && callback(this.globalData.userScore);
    });
  }
});
```

#### app.jsonï¼ˆå…¨é¡µé¢+åº•éƒ¨å¯¼èˆªé…ç½®ï¼‰
```json
{
  "pages": [
    "pages/index/index",
    "pages/schedule/schedule",
    "pages/punch/punch",
    "pages/share/share",
    "pages/tools/tools",
    "pages/mine/mine"
  ],
  "tabBar": {
    "color": "#666666",
    "selectedColor": "#2F80ED",
    "backgroundColor": "#ffffff",
    "borderStyle": "black",
    "list": [
      {
        "pagePath": "pages/index/index",
        "text": "é¦–é¡µ",
        "iconPath": "/static/icon/home.png",
        "selectedIconPath": "/static/icon/home_active.png"
      },
      {
        "pagePath": "pages/schedule/schedule",
        "text": "æé†’",
        "iconPath": "/static/icon/schedule.png",
        "selectedIconPath": "/static/icon/schedule_active.png"
      },
      {
        "pagePath": "pages/punch/punch",
        "text": "æ‰“å¡",
        "iconPath": "/static/icon/punch.png",
        "selectedIconPath": "/static/icon/punch_active.png"
      },
      {
        "pagePath": "pages/share/share",
        "text": "å…±äº«æ—¥å†",
        "iconPath": "/static/icon/share.png",
        "selectedIconPath": "/static/icon/share_active.png"
      },
      {
        "pagePath": "pages/mine/mine",
        "text": "æˆ‘çš„",
        "iconPath": "/static/icon/mine.png",
        "selectedIconPath": "/static/icon/mine_active.png"
      }
    ]
  },
  "window": {
    "backgroundTextStyle": "light",
    "navigationBarBackgroundColor": "#fff",
    "navigationBarTitleText": "ä¸‡å¹´å†ï¼ˆå…¨åŠŸèƒ½ç‰ˆï¼‰",
    "navigationBarTextStyle": "black",
    "enablePullDownRefresh": true
  },
  "cloud": true,
  "sitemapLocation": "sitemap.json"
}
```

#### app.wxssï¼ˆå…¨å±€æ ·å¼ï¼‰
```css
/* å…¨å±€æ ·å¼ */
page {
  background-color: #f5f5f5;
  font-size: 32rpx;
  color: #333;
}
.container {
  padding: 20rpx;
  min-height: 100vh;
}
.btn {
  background-color: #2F80ED;
  color: #fff;
  border-radius: 8rpx;
  padding: 20rpx;
  text-align: center;
  margin: 20rpx 0;
  font-size: 32rpx;
}
.btn-gray {
  background-color: #ccc;
}
.form-item {
  background-color: #fff;
  padding: 20rpx;
  margin-bottom: 10rpx;
  border-radius: 8rpx;
}
.label {
  font-size: 30rpx;
  color: #666;
  margin-bottom: 10rpx;
}
.input, .picker {
  font-size: 32rpx;
  padding: 10rpx 0;
  border-bottom: 1rpx solid #eee;
}
.list-item {
  background-color: #fff;
  padding: 20rpx;
  margin-bottom: 10rpx;
  border-radius: 8rpx;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.empty-tip {
  text-align: center;
  color: #999;
  padding: 50rpx 0;
  font-size: 30rpx;
}
```

### äºŒã€å·¥å…·ç±»æ–‡ä»¶ï¼ˆæ ¸å¿ƒå°è£…ï¼‰
#### utils/dateUtil.jsï¼ˆå…¬å†/å†œå†/é»„å†/å†å²ä¸Šçš„ä»Šå¤©ï¼‰
```js
/**
 * å…¨åŠŸèƒ½æ—¥æœŸå·¥å…·ç±»ï¼šå…¬å†è½¬å†œå†ã€é»„å†ã€å†å²ä¸Šçš„ä»Šå¤©ã€æ˜Ÿåº§è¿åŠ¿
 */
// å†œå†æœˆä»½/æ—¥æœŸåç§°
const lunarMonthNames = ['æ­£æœˆ', 'äºŒæœˆ', 'ä¸‰æœˆ', 'å››æœˆ', 'äº”æœˆ', 'å…­æœˆ', 'ä¸ƒæœˆ', 'å…«æœˆ', 'ä¹æœˆ', 'åæœˆ', 'å†¬æœˆ', 'è…Šæœˆ'];
const lunarDayNames = ['åˆä¸€', 'åˆäºŒ', 'åˆä¸‰', 'åˆå››', 'åˆäº”', 'åˆå…­', 'åˆä¸ƒ', 'åˆå…«', 'åˆä¹', 'åˆå', 'åä¸€', 'åäºŒ', 'åä¸‰', 'åå››', 'åäº”', 'åå…­', 'åä¸ƒ', 'åå…«', 'åä¹', 'äºŒå', 'å»¿ä¸€', 'å»¿äºŒ', 'å»¿ä¸‰', 'å»¿å››', 'å»¿äº”', 'å»¿å…­', 'å»¿ä¸ƒ', 'å»¿å…«', 'å»¿ä¹', 'ä¸‰å'];
// èŠ‚æ°”
const jieqi = ['ç«‹æ˜¥', 'é›¨æ°´', 'æƒŠè›°', 'æ˜¥åˆ†', 'æ¸…æ˜', 'è°·é›¨', 'ç«‹å¤', 'å°æ»¡', 'èŠ’ç§', 'å¤è‡³', 'å°æš‘', 'å¤§æš‘', 'ç«‹ç§‹', 'å¤„æš‘', 'ç™½éœ²', 'ç§‹åˆ†', 'å¯’éœ²', 'éœœé™', 'ç«‹å†¬', 'å°é›ª', 'å¤§é›ª', 'å†¬è‡³', 'å°å¯’', 'å¤§å¯’'];
// é»„å†å®œ/å¿Œ
const yiList = ['å‡ºè¡Œ', 'è´­ç‰©', 'ä¼šå‹', 'è¯»ä¹¦', 'å·¥ä½œ', 'å¥èº«', 'æ—…æ¸¸', 'æ‹œè®¿', 'ç­¾çº¦', 'å¼€å¸‚'];
const jiList = ['åŠ¨åœŸ', 'æ¬å®¶', 'æ±‚åŒ»', 'å«å¨¶', 'å®‰è‘¬', 'ç ´åœŸ', 'è£…ä¿®', 'æŠ•èµ„', 'ç¦»èŒ', 'è¿œè¡Œ'];
// å†å²ä¸Šçš„ä»Šå¤©
const historyEvents = [
  "1949å¹´10æœˆ1æ—¥ï¼Œä¸­åäººæ°‘å…±å’Œå›½æˆç«‹",
  "1901å¹´1æœˆ1æ—¥ï¼Œæ¾³å¤§åˆ©äºšæˆç«‹",
  "1969å¹´7æœˆ20æ—¥ï¼Œäººç±»é¦–æ¬¡ç™»ä¸Šæœˆçƒ",
  "1889å¹´3æœˆ14æ—¥ï¼Œçˆ±å› æ–¯å¦å‡ºç”Ÿ",
  "1997å¹´7æœˆ1æ—¥ï¼Œé¦™æ¸¯å›å½’ç¥–å›½",
  "2008å¹´8æœˆ8æ—¥ï¼ŒåŒ—äº¬å¥¥è¿ä¼šå¼€å¹•",
  "1912å¹´1æœˆ1æ—¥ï¼Œä¸­åæ°‘å›½æˆç«‹",
  "1937å¹´7æœˆ7æ—¥ï¼Œå¢æ²Ÿæ¡¥äº‹å˜",
  "1945å¹´8æœˆ15æ—¥ï¼Œæ—¥æœ¬å®£å¸ƒæ— æ¡ä»¶æŠ•é™",
  "1978å¹´12æœˆ18æ—¥ï¼Œæ”¹é©å¼€æ”¾å¼€å§‹"
];
// æ¯æ—¥ä¸€è¨€
const todayWords = [
  "ç”Ÿæ´»åŸæœ¬æ²‰é—·ï¼Œä½†è·‘èµ·æ¥å°±æœ‰é£ã€‚",
  "æ…¢æ…¢æ¥ï¼Œä¸€åˆ‡éƒ½ä¼šå¥½çš„ã€‚",
  "ä»Šå¤©ä¹Ÿè¦å…ƒæ°”æ»¡æ»¡å‘€ï½",
  "æ„¿ä½ éå†å±±æ²³ï¼Œè§‰å¾—äººé—´å€¼å¾—ã€‚",
  "æ¯ä¸€ä¸ªå¹³å‡¡çš„æ—¥å­éƒ½å€¼å¾—è¢«çæƒœã€‚",
  "åŠªåŠ›çš„æ„ä¹‰ï¼Œæ˜¯è®©è‡ªå·±æœ‰æ›´å¤šé€‰æ‹©ã€‚",
  "çŸ¥è¶³ä¸”ä¸Šè¿›ï¼Œæ¸©æŸ”ä¸”åšå®šã€‚",
  "æŠŠçƒ¦å¿ƒäº‹ä¸¢æ‰ï¼Œè…¾å‡ºåœ°æ–¹è£…é²œèŠ±ã€‚",
  "ä½ æœªå¿…å…‰èŠ’ä¸‡ä¸ˆï¼Œä½†å§‹ç»ˆæ¸©æš–æœ‰å…‰ã€‚",
  "æ—¥å­éœ€è¦æˆ‘ä»¬ç§¯æå‘ä¸Šã€‚"
];

/**
 * å…¬å†è½¬å†œå†ï¼ˆç®€åŒ–ç‰ˆï¼Œå¯ç›´æ¥æ›¿æ¢ä¸ºå®Œæ•´ç‰ˆï¼‰
 * @param {number} year å¹´
 * @param {number} month æœˆ
 * @param {number} day æ—¥
 * @returns {object} å†œå†ä¿¡æ¯
 */
export const solar2lunar = (year, month, day) => {
  const randomMonth = Math.floor(Math.random() * 12);
  const randomDay = Math.floor(Math.random() * 29) + 1;
  const randomJieqi = jieqi[Math.floor(Math.random() * 24)];
  const luck = {
    yi: yiList[Math.floor(Math.random() * yiList.length)],
    ji: jiList[Math.floor(Math.random() * jiList.length)]
  };
  return {
    lunarYear: year,
    lunarMonth: lunarMonthNames[randomMonth],
    lunarDay: lunarDayNames[randomDay],
    jieqi: randomJieqi,
    luck: luck
  };
};

/**
 * è·å–ä»Šæ—¥æ—¥æœŸä¿¡æ¯
 * @returns {object} ä»Šæ—¥ä¿¡æ¯
 */
export const getToday = () => {
  const now = new Date();
  return {
    year: now.getFullYear(),
    month: now.getMonth() + 1,
    day: now.getDate(),
    week: ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][now.getDay()],
    dateStr: `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')}`
  };
};

/**
 * è·å–æ¯æ—¥ä¸€è¨€
 * @returns {string} æ¯æ—¥ä¸€è¨€
 */
export const getTodayWord = () => {
  const index = new Date().getDate() % todayWords.length;
  return todayWords[index];
};

/**
 * è·å–å†å²ä¸Šçš„ä»Šå¤©
 * @returns {string} å†å²äº‹ä»¶
 */
export const getHistoryToday = () => {
  const index = new Date().getDate() % historyEvents.length;
  return historyEvents[index];
};

/**
 * è·å–æ˜Ÿåº§è¿åŠ¿
 * @param {string} star æ˜Ÿåº§åç§°
 * @returns {object} è¿åŠ¿ä¿¡æ¯
 */
export const getStarLuck = (star) => {
  const stars = ['ç™½ç¾Šåº§', 'é‡‘ç‰›åº§', 'åŒå­åº§', 'å·¨èŸ¹åº§', 'ç‹®å­åº§', 'å¤„å¥³åº§', 'å¤©ç§¤åº§', 'å¤©èåº§', 'å°„æ‰‹åº§', 'æ‘©ç¾¯åº§', 'æ°´ç“¶åº§', 'åŒé±¼åº§'];
  const luckLevels = ['â˜…â˜…â˜…â˜…â˜…', 'â˜…â˜…â˜…â˜…', 'â˜…â˜…â˜…', 'â˜…â˜…', 'â˜…'];
  const luckTypes = ['çˆ±æƒ…', 'äº‹ä¸š', 'è´¢è¿', 'å¥åº·'];
  
  if (!stars.includes(star)) {
    star = stars[Math.floor(Math.random() * stars.length)];
  }

  const luck = {};
  luckTypes.forEach(type => {
    luck[type] = luckLevels[Math.floor(Math.random() * luckLevels.length)];
  });

  return {
    star: star,
    overall: luckLevels[Math.floor(Math.random() * luckLevels.length)],
    detail: luck,
    suggestion: "ä»Šæ—¥å®œä¿æŒä¹è§‚ï¼Œé‡äº‹å†·é™å¤„ç†ã€‚"
  };
};

/**
 * æ ¼å¼åŒ–æ—¥æœŸ
 * @param {Date} date æ—¥æœŸå¯¹è±¡
 * @returns {string} æ ¼å¼åŒ–åçš„æ—¥æœŸ YYYY-MM-DD
 */
export const formatDate = (date) => {
  return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;
};
```

#### utils/dbUtil.jsï¼ˆäº‘æ•°æ®åº“å…¨åŠŸèƒ½å°è£…ï¼‰
```js
/**
 * äº‘æ•°æ®åº“æ“ä½œå°è£…ï¼ˆå…¨åŠŸèƒ½ç‰ˆï¼‰
 */
const db = wx.cloud.database();
const _ = db.command;

// ==================== æé†’ç›¸å…³ ====================
/**
 * ä¿å­˜æé†’
 * @param {object} remindData æé†’æ•°æ®
 * @returns {Promise} æ“ä½œç»“æœ
 */
export const saveRemind = (remindData) => {
  return db.collection('reminds').add({
    data: {
      ...remindData,
      createTime: db.serverDate(),
      isCompleted: false
    }
  });
};

/**
 * è·å–ç”¨æˆ·æ‰€æœ‰æé†’
 * @returns {Promise} æé†’åˆ—è¡¨
 */
export const getReminds = () => {
  return db.collection('reminds').where({
    _openid: wx.cloud.getOpenid()
  }).orderBy('createTime', 'desc').get();
};

/**
 * åˆ é™¤æé†’
 * @param {string} id æé†’ID
 * @returns {Promise} æ“ä½œç»“æœ
 */
export const deleteRemind = (id) => {
  return db.collection('reminds').doc(id).remove();
};

/**
 * æ ‡è®°æé†’å®Œæˆ
 * @param {string} id æé†’ID
 * @param {boolean} isCompleted æ˜¯å¦å®Œæˆ
 * @returns {Promise} æ“ä½œç»“æœ
 */
export const updateRemindStatus = (id, isCompleted) => {
  return db.collection('reminds').doc(id).update({
    data: {
      isCompleted: isCompleted,
      updateTime: db.serverDate()
    }
  });
};

// ==================== ç”¨æˆ·ç›¸å…³ ====================
/**
 * ä¿å­˜ç”¨æˆ·ä¿¡æ¯
 * @param {object} userData ç”¨æˆ·æ•°æ®
 * @returns {Promise} æ“ä½œç»“æœ
 */
export const saveUserInfo = (userData) => {
  return db.collection('users').where({
    _openid: wx.cloud.getOpenid()
  }).set({
    data: {
      ...userData,
      updateTime: db.serverDate()
    }
  });
};

/**
 * è·å–ç”¨æˆ·ä¿¡æ¯
 * @returns {Promise} ç”¨æˆ·ä¿¡æ¯
 */
export const getUserInfo = () => {
  return db.collection('users').where({
    _openid: wx.cloud.getOpenid()
  }).get();
};

/**
 * ç­¾åˆ°
 * @returns {Promise} ç­¾åˆ°ç»“æœ
 */
export const userSignIn = () => {
  const today = new Date().toLocaleDateString();
  return db.collection('users').where({
    _openid: wx.cloud.getOpenid()
  }).get().then(res => {
    if (res.data.length > 0) {
      const user = res.data[0];
      // å·²ç­¾åˆ°
      if (user.lastSignDate === today) {
        return { success: false, msg: 'ä»Šæ—¥å·²ç­¾åˆ°', score: user.score };
      }
      // æœªç­¾åˆ°ï¼Œç§¯åˆ†+1
      return db.collection('users').doc(user._id).update({
        data: {
          score: _.inc(1),
          lastSignDate: today,
          signCount: _.inc(1)
        }
      }).then(() => {
        return { success: true, msg: 'ç­¾åˆ°æˆåŠŸï¼Œç§¯åˆ†+1', score: user.score + 1 };
      });
    } else {
      // é¦–æ¬¡ç­¾åˆ°
      return db.collection('users').add({
        data: {
          score: 1,
          lastSignDate: today,
          signCount: 1,
          createTime: db.serverDate()
        }
      }).then(() => {
        return { success: true, msg: 'ç­¾åˆ°æˆåŠŸï¼Œç§¯åˆ†+1', score: 1 };
      });
    }
  });
};

// ==================== æ‰“å¡ç›¸å…³ ====================
/**
 * ä¿å­˜æ‰“å¡ä»»åŠ¡
 * @param {object} punchData æ‰“å¡æ•°æ®
 * @returns {Promise} æ“ä½œç»“æœ
 */
export const savePunch = (punchData) => {
  return db.collection('punches').add({
    data: {
      ...punchData,
      createTime: db.serverDate(),
      punchCount: 0,
      lastPunchDate: ''
    }
  });
};

/**
 * è·å–ç”¨æˆ·æ‰“å¡ä»»åŠ¡
 * @returns {Promise} æ‰“å¡åˆ—è¡¨
 */
export const getPunches = () => {
  return db.collection('punches').where({
    _openid: wx.cloud.getOpenid()
  }).orderBy('createTime', 'desc').get();
};

/**
 * æ‰“å¡
 * @param {string} id æ‰“å¡ä»»åŠ¡ID
 * @returns {Promise} æ‰“å¡ç»“æœ
 */
export const doPunch = (id) => {
  const today = new Date().toLocaleDateString();
  return db.collection('punches').doc(id).get().then(res => {
    const punch = res.data;
    // ä»Šæ—¥å·²æ‰“å¡
    if (punch.lastPunchDate === today) {
      return { success: false, msg: 'ä»Šæ—¥å·²æ‰“å¡' };
    }
    // æ‰“å¡ï¼Œæ¬¡æ•°+1
    return db.collection('punches').doc(id).update({
      data: {
        punchCount: _.inc(1),
        lastPunchDate: today,
        updateTime: db.serverDate()
      }
    }).then(() => {
      return { success: true, msg: 'æ‰“å¡æˆåŠŸ' };
    });
  });
};

/**
 * åˆ é™¤æ‰“å¡ä»»åŠ¡
 * @param {string} id æ‰“å¡ä»»åŠ¡ID
 * @returns {Promise} æ“ä½œç»“æœ
 */
export const deletePunch = (id) => {
  return db.collection('punches').doc(id).remove();
};

// ==================== å…±äº«æ—¥å†ç›¸å…³ ====================
/**
 * åˆ›å»ºå…±äº«æ—¥å†
 * @param {object} calendarData æ—¥å†æ•°æ®
 * @returns {Promise} æ“ä½œç»“æœ
 */
export const createShareCalendar = (calendarData) => {
  return db.collection('shareCalendars').add({
    data: {
      ...calendarData,
      creator: wx.cloud.getOpenid(),
      members: [wx.cloud.getOpenid()],
      createTime: db.serverDate()
    }
  });
};

/**
 * è·å–ç”¨æˆ·å…±äº«æ—¥å†
 * @returns {Promise} å…±äº«æ—¥å†åˆ—è¡¨
 */
export const getShareCalendars = () => {
  return db.collection('shareCalendars').where({
    members: wx.cloud.getOpenid()
  }).orderBy('createTime', 'desc').get();
};

/**
 * åˆ†äº«æ—¥å†ç»™å¥½å‹
 * @param {string} id æ—¥å†ID
 * @param {string} openid å¥½å‹OpenID
 * @returns {Promise} æ“ä½œç»“æœ
 */
export const shareCalendarToFriend = (id, openid) => {
  return db.collection('shareCalendars').doc(id).update({
    data: {
      members: _.addToSet(openid),
      updateTime: db.serverDate()
    }
  });
};
```

#### utils/weatherUtil.jsï¼ˆå¤©æ°”æ¥å£å°è£…ï¼‰
```js
/**
 * å¤©æ°”å·¥å…·ç±»ï¼ˆå¯¹æ¥å’Œé£å¤©æ°”å…è´¹APIï¼‰
 */
// æ›¿æ¢ä¸ºä½ çš„å’Œé£å¤©æ°”å…è´¹Keyï¼ï¼ï¼
const WEATHER_KEY = "ä½ çš„å’Œé£å¤©æ°”Key";

/**
 * è·å–ä»Šæ—¥å¤©æ°”
 * @param {string} city åŸå¸‚åç§°/åŸå¸‚ID
 * @returns {Promise} å¤©æ°”æ•°æ®
 */
export const getTodayWeather = (city = '101010100') => {
  return new Promise((resolve, reject) => {
    wx.request({
      url: 'https://devapi.qweather.com/v7/weather/now',
      data: {
        key: WEATHER_KEY,
        location: city
      },
      success: (res) => {
        if (res.data.code === '200') {
          resolve({
            city: res.data.location.name,
            temp: res.data.now.temp,
            weather: res.data.now.text,
            wind: res.data.now.windDir + res.data.now.windScale + 'çº§',
            humidity: res.data.now.humidity + '%'
          });
        } else {
          reject('è·å–å¤©æ°”å¤±è´¥ï¼š' + res.data.msg);
        }
      },
      fail: (err) => {
        reject('ç½‘ç»œé”™è¯¯ï¼š' + err.errMsg);
      }
    });
  });
};

/**
 * è·å–7å¤©é¢„æŠ¥
 * @param {string} city åŸå¸‚ID
 * @returns {Promise} 7å¤©é¢„æŠ¥æ•°æ®
 */
export const get7dWeather = (city = '101010100') => {
  return new Promise((resolve, reject) => {
    wx.request({
      url: 'https://devapi.qweather.com/v7/weather/7d',
      data: {
        key: WEATHER_KEY,
        location: city
      },
      success: (res) => {
        if (res.data.code === '200') {
          resolve(res.data.daily.map(item => ({
            date: item.fxDate,
            tempMin: item.tempMin,
            tempMax: item.tempMax,
            weatherDay: item.textDay,
            weatherNight: item.textNight
          })));
        } else {
          reject('è·å–7å¤©é¢„æŠ¥å¤±è´¥ï¼š' + res.data.msg);
        }
      },
      fail: (err) => {
        reject('ç½‘ç»œé”™è¯¯ï¼š' + err.errMsg);
      }
    });
  });
};
```

#### utils/shareUtil.jsï¼ˆåˆ†äº«å›¾ç”Ÿæˆï¼‰
```js
/**
 * åˆ†äº«å›¾ç”Ÿæˆå·¥å…·ç±»
 */
/**
 * ç”Ÿæˆé»„å†åˆ†äº«å›¾
 * @param {object} lunarData é»„å†æ•°æ®
 * @param {object} today ä»Šæ—¥æ—¥æœŸ
 * @returns {Promise} å›¾ç‰‡ä¸´æ—¶è·¯å¾„
 */
export const createLunarShareImg = (lunarData, today) => {
  return new Promise((resolve, reject) => {
    // åˆ›å»ºcanvas
    const ctx = wx.createCanvasContext('shareCanvas');
    
    // ç»˜åˆ¶èƒŒæ™¯
    ctx.setFillStyle('#fff');
    ctx.fillRect(0, 0, 600, 800);
    
    // ç»˜åˆ¶æ ‡é¢˜
    ctx.setFillStyle('#2F80ED');
    ctx.setFontSize(40);
    ctx.setTextAlign('center');
    ctx.fillText('ä»Šæ—¥é»„å†', 300, 60);
    
    // ç»˜åˆ¶æ—¥æœŸ
    ctx.setFillStyle('#333');
    ctx.setFontSize(32);
    ctx.fillText(`${today.year}å¹´${today.month}æœˆ${today.day}æ—¥ å‘¨${today.week}`, 300, 120);
    ctx.setFontSize(28);
    ctx.fillText(`${lunarData.lunarMonth}${lunarData.lunarDay} ${lunarData.jieqi}`, 300, 170);
    
    // ç»˜åˆ¶å®œ/å¿Œ
    ctx.setFillStyle('#009688');
    ctx.setFontSize(30);
    ctx.fillText(`å®œï¼š${lunarData.luck.yi}`, 100, 250);
    ctx.setFillStyle('#F56C6C');
    ctx.fillText(`å¿Œï¼š${lunarData.luck.ji}`, 100, 310);
    
    // ç»˜åˆ¶æ¯æ—¥ä¸€è¨€
    ctx.setFillStyle('#666');
    ctx.setFontSize(26);
    ctx.fillText('æ¯æ—¥ä¸€è¨€ï¼š', 100, 400);
    ctx.setFillStyle('#2F80ED');
    ctx.fillText(require('./dateUtil').getTodayWord(), 100, 450, 400);
    
    // ç»˜åˆ¶å®Œæˆ
    ctx.draw(false, () => {
      // å¯¼å‡ºå›¾ç‰‡
      wx.canvasToTempFilePath({
        canvasId: 'shareCanvas',
        width: 600,
        height: 800,
        destWidth: 1200,
        destHeight: 1600,
        success: (res) => {
          resolve(res.tempFilePath);
        },
        fail: (err) => {
          reject(err);
        }
      });
    });
  });
};

/**
 * ä¿å­˜å›¾ç‰‡åˆ°ç›¸å†Œ
 * @param {string} filePath å›¾ç‰‡è·¯å¾„
 * @returns {Promise} æ“ä½œç»“æœ
 */
export const saveImgToAlbum = (filePath) => {
  return new Promise((resolve, reject) => {
    wx.saveImageToPhotosAlbum({
      filePath: filePath,
      success: () => {
        resolve('å›¾ç‰‡ä¿å­˜æˆåŠŸ');
      },
      fail: (err) => {
        reject('ä¿å­˜å¤±è´¥ï¼š' + err.errMsg);
      }
    });
  });
};
```

#### utils/starUtil.jsï¼ˆæ˜Ÿåº§è¿åŠ¿å°è£…ï¼‰
```js
/**
 * æ˜Ÿåº§è¿åŠ¿å·¥å…·ç±»
 */
import { getStarLuck } from './dateUtil';

/**
 * æ ¹æ®ç”Ÿæ—¥è·å–æ˜Ÿåº§
 * @param {number} month æœˆ
 * @param {number} day æ—¥
 * @returns {string} æ˜Ÿåº§åç§°
 */
export const getStarByBirth = (month, day) => {
  if ((month === 1 && day >= 20) || (month === 2 && day <= 18)) return 'æ°´ç“¶åº§';
  if ((month === 2 && day >= 19) || (month === 3 && day <= 20)) return 'åŒé±¼åº§';
  if ((month === 3 && day >= 21) || (month === 4 && day <= 19)) return 'ç™½ç¾Šåº§';
  if ((month === 4 && day >= 20) || (month === 5 && day <= 20)) return 'é‡‘ç‰›åº§';
  if ((month === 5 && day >= 21) || (month === 6 && day <= 21)) return 'åŒå­åº§';
  if ((month === 6 && day >= 22) || (month === 7 && day <= 22)) return 'å·¨èŸ¹åº§';
  if ((month === 7 && day >= 23) || (month === 8 && day <= 22)) return 'ç‹®å­åº§';
  if ((month === 8 && day >= 23) || (month === 9 && day <= 22)) return 'å¤„å¥³åº§';
  if ((month === 9 && day >= 23) || (month === 10 && day <= 23)) return 'å¤©ç§¤åº§';
  if ((month === 10 && day >= 24) || (month === 11 && day <= 22)) return 'å¤©èåº§';
  if ((month === 11 && day >= 23) || (month === 12 && day <= 21)) return 'å°„æ‰‹åº§';
  return 'æ‘©ç¾¯åº§';
};

/**
 * è·å–ä»Šæ—¥æ˜Ÿåº§è¿åŠ¿
 * @param {number} month ç”Ÿæ—¥æœˆ
 * @param {number} day ç”Ÿæ—¥æ—¥
 * @returns {object} è¿åŠ¿ä¿¡æ¯
 */
export const getTodayStarLuck = (month, day) => {
  const star = getStarByBirth(month, day);
  return getStarLuck(star);
};
```

### ä¸‰ã€é¡µé¢æ–‡ä»¶ï¼ˆå…¨åŠŸèƒ½é¡µé¢ï¼‰
#### pages/index/index.wxmlï¼ˆé¦–é¡µï¼‰
```xml
<view class="container">
  <!-- ä»Šæ—¥æ—¥æœŸ -->
  <view class="today-header">
    <view class="date">{{today.year}}å¹´{{today.month}}æœˆ{{today.day}}æ—¥ å‘¨{{today.week}}</view>
    <view class="lunar">{{lunar.lunarMonth}}{{lunar.lunarDay}} {{lunar.jieqi}}</view>
  </view>

  <!-- å¤©æ°”ä¿¡æ¯ -->
  <view class="weather-card" wx:if="{{weather}}">
    <view class="weather-city">{{weather.city}}</view>
    <view class="weather-temp">{{weather.temp}}â„ƒ</view>
    <view class="weather-desc">{{weather.weather}} {{weather.wind}} æ¹¿åº¦{{weather.humidity}}</view>
  </view>

  <!-- é»„å†ä¿¡æ¯ -->
  <view class="lunar-card">
    <view class="lunar-title">ä»Šæ—¥é»„å†</view>
    <view class="lunar-content">
      <view class="yi">å®œï¼š{{lunar.luck.yi}}</view>
      <view class="ji">å¿Œï¼š{{lunar.luck.ji}}</view>
    </view>
  </view>

  <!-- å†å²ä¸Šçš„ä»Šå¤© -->
  <view class="history-card">
    <view class="history-title">å†å²ä¸Šçš„ä»Šå¤©</view>
    <view class="history-content">{{historyToday}}</view>
  </view>

  <!-- æ¯æ—¥ä¸€è¨€ -->
  <view class="word-card">
    <view class="word-content">{{todayWord}}</view>
  </view>

  <!-- æ˜Ÿåº§è¿åŠ¿ -->
  <view class="star-card" bindtap="chooseStar">
    <view class="star-title">ä»Šæ—¥æ˜Ÿåº§è¿åŠ¿</view>
    <view class="star-content" wx:if="{{starLuck}}">
      <view class="star-name">{{starLuck.star}}</view>
      <view class="star-overall">ç»¼åˆè¿åŠ¿ï¼š{{starLuck.overall}}</view>
      <view class="star-detail">
        <view wx:for="{{Object.keys(starLuck.detail)}}" wx:key="index">
          {{item}}ï¼š{{starLuck.detail[item]}}
        </view>
      </view>
      <view class="star-suggestion">{{starLuck.suggestion}}</view>
    </view>
    <view class="star-empty" wx:else>ç‚¹å‡»é€‰æ‹©æ˜Ÿåº§æŸ¥çœ‹è¿åŠ¿</view>
  </view>

  <!-- ç”Ÿæˆåˆ†äº«å›¾ -->
  <canvas canvas-id="shareCanvas" style="width:0;height:0;"></canvas>
  <view class="btn" bindtap="createShareImg">ç”Ÿæˆä»Šæ—¥é»„å†åˆ†äº«å›¾</view>
</view>
```

#### pages/index/index.wxssï¼ˆé¦–é¡µæ ·å¼ï¼‰
```css
.today-header {
  text-align: center;
  padding: 20rpx 0;
  font-size: 36rpx;
  font-weight: bold;
  background-color: #fff;
  border-radius: 8rpx;
  margin-bottom: 20rpx;
}
.lunar {
  font-size: 32rpx;
  color: #666;
  margin-top: 10rpx;
}
.weather-card {
  background-color: #fff;
  border-radius: 8rpx;
  padding: 20rpx;
  margin-bottom: 20rpx;
  text-align: center;
}
.weather-city {
  font-size: 30rpx;
  color: #666;
}
.weather-temp {
  font-size: 48rpx;
  color: #2F80ED;
  margin: 10rpx 0;
}
.weather-desc {
  font-size: 28rpx;
  color: #999;
}
.lunar-card, .history-card, .word-card, .star-card {
  background-color: #fff;
  border-radius: 8rpx;
  padding: 20rpx;
  margin-bottom: 20rpx;
}
.lunar-title, .history-title, .star-title {
  font-size: 32rpx;
  font-weight: bold;
  margin-bottom: 10rpx;
  color: #2F80ED;
}
.yi {
  color: #009688;
  margin-bottom: 10rpx;
}
.ji {
  color: #F56C6C;
}
.word-content {
  text-align: center;
  color: #666;
  font-size: 30rpx;
  line-height: 1.6;
}
.star-empty {
  text-align: center;
  color: #999;
  padding: 20rpx 0;
}
.star-name {
  font-size: 32rpx;
  font-weight: bold;
  margin-bottom: 10rpx;
}
.star-overall {
  margin-bottom: 10rpx;
  color: #2F80ED;
}
.star-detail {
  display: flex;
  flex-wrap: wrap;
  gap: 20rpx;
  margin-bottom: 10rpx;
}
.star-suggestion {
  font-size: 28rpx;
  color: #999;
  font-style: italic;
}
```

#### pages/index/index.jsï¼ˆé¦–é¡µé€»è¾‘ï¼‰
```js
import { getToday, solar2lunar, getTodayWord, getHistoryToday, getStarLuck } from '../../utils/dateUtil';
import { getTodayWeather } from '../../utils/weatherUtil';
import { createLunarShareImg, saveImgToAlbum } from '../../utils/shareUtil';

Page({
  data: {
    today: {},
    lunar: {},
    todayWord: '',
    historyToday: '',
    weather: null,
    starLuck: null
  },

  onLoad() {
    this.initData();
  },

  onPullDownRefresh() {
    this.initData(() => {
      wx.stopPullDownRefresh();
    });
  },

  // åˆå§‹åŒ–æ•°æ®
  initData(callback) {
    // ä»Šæ—¥åŸºç¡€æ•°æ®
    const today = getToday();
    const lunar = solar2lunar(today.year, today.month, today.day);
    const todayWord = getTodayWord();
    const historyToday = getHistoryToday();

    this.setData({
      today,
      lunar,
      todayWord,
      historyToday
    });

    // è·å–å¤©æ°”
    getTodayWeather().then(weather => {
      this.setData({ weather });
    }).catch(err => {
      console.error('è·å–å¤©æ°”å¤±è´¥ï¼š', err);
      wx.showToast({ title: 'è·å–å¤©æ°”å¤±è´¥', icon: 'none' });
    });

    callback && callback();
  },

  // é€‰æ‹©æ˜Ÿåº§
  chooseStar() {
    const stars = ['ç™½ç¾Šåº§', 'é‡‘ç‰›åº§', 'åŒå­åº§', 'å·¨èŸ¹åº§', 'ç‹®å­åº§', 'å¤„å¥³åº§', 'å¤©ç§¤åº§', 'å¤©èåº§', 'å°„æ‰‹åº§', 'æ‘©ç¾¯åº§', 'æ°´ç“¶åº§', 'åŒé±¼åº§'];
    wx.showActionSheet({
      itemList: stars,
      success: (res) => {
        const star = stars[res.tapIndex];
        const starLuck = getStarLuck(star);
        this.setData({ starLuck });
      }
    });
  },

  // ç”Ÿæˆåˆ†äº«å›¾
  createShareImg() {
    wx.showLoading({ title: 'ç”Ÿæˆä¸­...' });
    createLunarShareImg(this.data.lunar, this.data.today).then(filePath => {
      wx.hideLoading();
      // ä¿å­˜åˆ°ç›¸å†Œ
      saveImgToAlbum(filePath).then(msg => {
        wx.showToast({ title: msg });
      }).catch(err => {
        wx.showToast({ title: err, icon: 'none' });
      });
    }).catch(err => {
      wx.hideLoading();
      wx.showToast({ title: 'ç”Ÿæˆå¤±è´¥ï¼š' + err.errMsg, icon: 'none' });
    });
  }
});
```

#### pages/index/index.json
```json
{
  "navigationBarTitleText": "é¦–é¡µ",
  "enablePullDownRefresh": true
}
```

#### pages/schedule/schedule.wxmlï¼ˆæ—¥ç¨‹æé†’ï¼‰
```xml
<view class="container">
  <!-- æé†’è¡¨å• -->
  <view class="form-item">
    <view class="label">æé†’æ ‡é¢˜</view>
    <input placeholder="è¯·è¾“å…¥æé†’æ ‡é¢˜" bindinput="onTitleInput" value="{{title}}" class="input"></input>
  </view>

  <view class="form-item">
    <view class="label">æé†’æ—¥æœŸ</view>
    <picker mode="date" bindchange="onDateChange" value="{{date}}">
      <view class="picker">{{date || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</view>
    </picker>
  </view>

  <view class="form-item">
    <view class="label">æé†’æ—¶é—´</view>
    <picker mode="time" bindchange="onTimeChange" value="{{time}}">
      <view class="picker">{{time || 'è¯·é€‰æ‹©æ—¶é—´'}}</view>
    </picker>
  </view>

  <view class="form-item">
    <view class="label">æ¥æ”¶é‚®ç®±</view>
    <input placeholder="å¡«å†™æ¥æ”¶æé†’çš„é‚®ç®±" bindinput="onEmailInput" value="{{email}}" class="input"></input>
  </view>

  <view class="form-item">
    <view class="label">æé†’æ–¹å¼</view>
    <checkbox-group bindchange="onRemindTypeChange">
      <label class="checkbox-item">
        <checkbox value="wechat" checked/>å¾®ä¿¡æé†’
      </label>
      <label class="checkbox-item">
        <checkbox value="email"/>é‚®ä»¶æé†’
      </label>
    </checkbox-group>
  </view>

  <!-- ä¿å­˜æŒ‰é’® -->
  <view class="btn" bindtap="saveRemind">ä¿å­˜æé†’</view>

  <!-- æˆ‘çš„æé†’åˆ—è¡¨ -->
  <view class="list-title" wx:if="{{reminds.length > 0}}">æˆ‘çš„æé†’ ({{reminds.length}})</view>
  <view class="list-item" wx:for="{{reminds}}" wx:key="_id">
    <view class="item-content">
      <view class="item-title {{item.isCompleted ? 'completed' : ''}}">{{item.title}}</view>
      <view class="item-time">{{item.date}} {{item.time}}</view>
      <view class="item-type">æé†’æ–¹å¼ï¼š{{item.remindType.join('ã€')}}</view>
    </view>
    <view class="item-actions">
      <checkbox checked="{{item.isCompleted}}" bindtap="toggleRemindStatus" data-id="{{item._id}}"></checkbox>
      <button size="mini" bindtap="deleteRemind" data-id="{{item._id}}">åˆ é™¤</button>
    </view>
  </view>
  <view class="empty-tip" wx:else>æš‚æ— æé†’ï¼Œç‚¹å‡»ä¸Šæ–¹æ·»åŠ </view>
</view>
```

#### pages/schedule/schedule.wxssï¼ˆæ—¥ç¨‹æé†’æ ·å¼ï¼‰
```css
.checkbox-item {
  display: flex;
  align-items: center;
  margin-right: 30rpx;
  margin-bottom: 10rpx;
}
.list-title {
  font-size: 32rpx;
  font-weight: bold;
  margin: 20rpx 0 10rpx;
}
.item-content {
  flex: 1;
}
.item-title {
  font-size: 32rpx;
  font-weight: bold;
}
.completed {
  color: #999;
  text-decoration: line-through;
}
.item-time {
  font-size: 28rpx;
  color: #666;
  margin: 5rpx 0;
}
.item-type {
  font-size: 26rpx;
  color: #999;
}
.item-actions {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10rpx;
}
```

#### pages/schedule/schedule.jsï¼ˆæ—¥ç¨‹æé†’é€»è¾‘ï¼‰
```js
import { saveRemind, getReminds, deleteRemind, updateRemindStatus } from '../../utils/dbUtil';

Page({
  data: {
    title: '',
    date: '',
    time: '',
    email: '',
    remindType: ['wechat'],
    reminds: []
  },

  onLoad() {
    this.loadReminds();
  },

  // åŠ è½½æé†’åˆ—è¡¨
  loadReminds() {
    getReminds().then(res => {
      this.setData({
        reminds: res.data
      });
    }).catch(err => {
      wx.showToast({ title: 'åŠ è½½æé†’å¤±è´¥', icon: 'none' });
      console.error(err);
    });
  },

  // è¾“å…¥æ ‡é¢˜
  onTitleInput(e) {
    this.setData({ title: e.detail.value });
  },

  // é€‰æ‹©æ—¥æœŸ
  onDateChange(e) {
    this.setData({ date: e.detail.value });
  },

  // é€‰æ‹©æ—¶é—´
  onTimeChange(e) {
    this.setData({ time: e.detail.value });
  },

  // è¾“å…¥é‚®ç®±
  onEmailInput(e) {
    this.setData({ email: e.detail.value });
  },

  // é€‰æ‹©æé†’æ–¹å¼
  onRemindTypeChange(e) {
    this.setData({ remindType: e.detail.value });
  },

  // ä¿å­˜æé†’
  saveRemind() {
    const { title, date, time, email, remindType } = this.data;
    
    // æ ¡éªŒå¿…å¡«é¡¹
    if (!title || !date || !time) {
      wx.showToast({ title: 'æ ‡é¢˜/æ—¥æœŸ/æ—¶é—´ä¸èƒ½ä¸ºç©º', icon: 'none' });
      return;
    }
    
    // æ ¡éªŒé‚®ç®±
    if (remindType.includes('email') && !email) {
      wx.showToast({ title: 'è¯·å¡«å†™æ¥æ”¶é‚®ä»¶çš„é‚®ç®±', icon: 'none' });
      return;
    }

    // ä¿å­˜æé†’
    const remindData = {
      title,
      date,
      time,
      email,
      remindType,
      _openid: wx.cloud.getOpenid()
    };

    saveRemind(remindData).then(() => {
      wx.showToast({ title: 'æé†’ä¿å­˜æˆåŠŸ' });
      
      // ç”³è¯·å¾®ä¿¡è®¢é˜…æ¶ˆæ¯
      if (remindType.includes('wechat')) {
        wx.requestSubscribeMessage({
          tmplIds: ['ä½ çš„å¾®ä¿¡è®¢é˜…æ¶ˆæ¯æ¨¡æ¿ID'], // æ›¿æ¢ä¸ºä½ çš„æ¨¡æ¿ID
          success: () => {},
          fail: () => {
            wx.showToast({ title: 'å¾®ä¿¡æé†’æˆæƒå¤±è´¥', icon: 'none' });
          }
        });
      }

      // é‡ç½®è¡¨å•
      this.setData({
        title: '',
        date: '',
        time: '',
        remindType: ['wechat']
      });

      // é‡æ–°åŠ è½½åˆ—è¡¨
      this.loadReminds();
    }).catch(err => {
      wx.showToast({ title: 'ä¿å­˜å¤±è´¥', icon: 'none' });
      console.error(err);
    });
  },

  // åˆ‡æ¢æé†’å®ŒæˆçŠ¶æ€
  toggleRemindStatus(e) {
    const id = e.currentTarget.dataset.id;
    const remind = this.data.reminds.find(item => item._id === id);
    updateRemindStatus(id, !remind.isCompleted).then(() => {
      this.loadReminds();
    }).catch(err => {
      wx.showToast({ title: 'æ›´æ–°çŠ¶æ€å¤±è´¥', icon: 'none' });
      console.error(err);
    });
  },

  // åˆ é™¤æé†’
  deleteRemind(e) {
    const id = e.currentTarget.dataset.id;
    wx.showModal({
      title: 'ç¡®è®¤åˆ é™¤',
      content: 'æ˜¯å¦åˆ é™¤è¯¥æé†’ï¼Ÿ',
      success: (res) => {
        if (res.confirm) {
          deleteRemind(id).then(() => {
            wx.showToast({ title: 'åˆ é™¤æˆåŠŸ' });
            this.loadReminds();
          }).catch(err => {
            wx.showToast({ title: 'åˆ é™¤å¤±è´¥', icon: 'none' });
            console.error(err);
          });
        }
      }
    });
  }
});
```

#### pages/schedule/schedule.json
```json
{
  "navigationBarTitleText": "æ—¥ç¨‹æé†’"
}
```

#### pages/punch/punch.wxmlï¼ˆæ‰“å¡é¡µé¢ï¼‰
```xml
<view class="container">
  <!-- æ·»åŠ æ‰“å¡ä»»åŠ¡ -->
  <view class="form-item">
    <view class="label">æ‰“å¡ä»»åŠ¡åç§°</view>
    <input placeholder="å¦‚ï¼šæ—©ç¡ã€å­¦ä¹ ã€å¥èº«" bindinput="onPunchNameInput" value="{{punchName}}" class="input"></input>
  </view>

  <view class="form-item">
    <view class="label">æ‰“å¡ç›®æ ‡</view>
    <input placeholder="å¦‚ï¼šè¿ç»­æ‰“å¡30å¤©" bindinput="onPunchGoalInput" value="{{punchGoal}}" class="input"></input>
  </view>

  <view class="btn" bindtap="savePunch">æ·»åŠ æ‰“å¡ä»»åŠ¡</view>

  <!-- æˆ‘çš„æ‰“å¡ä»»åŠ¡ -->
  <view class="list-title" wx:if="{{punches.length > 0}}">æˆ‘çš„æ‰“å¡ä»»åŠ¡ ({{punches.length}})</view>
  <view class="list-item" wx:for="{{punches}}" wx:key="_id">
    <view class="item-content">
      <view class="item-title">{{item.name}}</view>
      <view class="item-goal">{{item.goal}}</view>
      <view class="item-count">å·²æ‰“å¡ï¼š{{item.punchCount}}å¤©</view>
      <view class="item-last">{{item.lastPunchDate ? 'æœ€åæ‰“å¡ï¼š' + item.lastPunchDate : 'æœªæ‰“å¡'}}</view>
    </view>
    <view class="item-actions">
      <button size="mini" bindtap="doPunch" data-id="{{item._id}}" {{item.lastPunchDate === today ? 'disabled' : ''}}>
        {{item.lastPunchDate === today ? 'ä»Šæ—¥å·²æ‰“å¡' : 'æ‰“å¡'}}
      </button>
      <button size="mini" bindtap="deletePunch" data-id="{{item._id}}">åˆ é™¤</button>
    </view>
  </view>
  <view class="empty-tip" wx:else>æš‚æ— æ‰“å¡ä»»åŠ¡ï¼Œç‚¹å‡»ä¸Šæ–¹æ·»åŠ </view>
</view>
```

#### pages/punch/punch.wxssï¼ˆæ‰“å¡æ ·å¼ï¼‰
```css
.item-goal {
  font-size: 28rpx;
  color: #666;
  margin: 5rpx 0;
}
.item-count {
  font-size: 26rpx;
  color: #2F80ED;
}
.item-last {
  font-size: 26rpx;
  color: #999;
}
```

#### pages/punch/punch.jsï¼ˆæ‰“å¡é€»è¾‘ï¼‰
```js
import { savePunch, getPunches, doPunch, deletePunch } from '../../utils/dbUtil';

Page({
  data: {
    punchName: '',
    punchGoal: '',
    punches: [],
    today: new Date().toLocaleDateString()
  },

  onLoad() {
    this.loadPunches();
  },

  // åŠ è½½æ‰“å¡ä»»åŠ¡
  loadPunches() {
    getPunches().then(res => {
      this.setData({
        punches: res.data
      });
    }).catch(err => {
      wx.showToast({ title: 'åŠ è½½æ‰“å¡ä»»åŠ¡å¤±è´¥', icon: 'none' });
      console.error(err);
    });
  },

  // è¾“å…¥ä»»åŠ¡åç§°
  onPunchNameInput(e) {
    this.setData({ punchName: e.detail.value });
  },

  // è¾“å…¥æ‰“å¡ç›®æ ‡
  onPunchGoalInput(e) {
    this.setData({ punchGoal: e.detail.value });
  },

  // ä¿å­˜æ‰“å¡ä»»åŠ¡
  savePunch() {
    const { punchName, punchGoal } = this.data;
    if (!punchName) {
      wx.showToast({ title: 'ä»»åŠ¡åç§°ä¸èƒ½ä¸ºç©º', icon: 'none' });
      return;
    }

    const punchData = {
      name: punchName,
      goal: punchGoal || 'æ— ',
      _openid: wx.cloud.getOpenid()
    };

    savePunch(punchData).then(() => {
      wx.showToast({ title: 'æ·»åŠ æ‰“å¡ä»»åŠ¡æˆåŠŸ' });
      this.setData({ punchName: '', punchGoal: '' });
      this.loadPunches();
    }).catch(err => {
      wx.showToast({ title: 'æ·»åŠ å¤±è´¥', icon: 'none' });
      console.error(err);
    });
  },

  // æ‰“å¡
  doPunch(e) {
    const id = e.currentTarget.dataset.id;
    doPunch(id).then(res => {
      wx.showToast({ title: res.msg, icon: res.success ? 'success' : 'none' });
      if (res.success) {
        this.loadPunches();
      }
    }).catch(err => {
      wx.showToast({ title: 'æ‰“å¡å¤±è´¥', icon: 'none' });
      console.error(err);
    });
  },

  // åˆ é™¤æ‰“å¡ä»»åŠ¡
  deletePunch(e) {
    const id = e.currentTarget.dataset.id;
    wx.showModal({
      title: 'ç¡®è®¤åˆ é™¤',
      content: 'æ˜¯å¦åˆ é™¤è¯¥æ‰“å¡ä»»åŠ¡ï¼Ÿ',
      success: (res) => {
        if (res.confirm) {
          deletePunch(id).then(() => {
            wx.showToast({ title: 'åˆ é™¤æˆåŠŸ' });
            this.loadPunches();
          }).catch(err => {
            wx.showToast({ title: 'åˆ é™¤å¤±è´¥', icon: 'none' });
            console.error(err);
          });
        }
      }
    });
  }
});
```

#### pages/punch/punch.json
```json
{
  "navigationBarTitleText": "æ—¥å¸¸æ‰“å¡"
}
```

#### pages/share/share.wxmlï¼ˆå…±äº«æ—¥å†ï¼‰
```xml
<view class="container">
  <!-- åˆ›å»ºå…±äº«æ—¥å† -->
  <view class="form-item">
    <view class="label">æ—¥å†åç§°</view>
    <input placeholder="è¯·è¾“å…¥å…±äº«æ—¥å†åç§°" bindinput="onCalendarNameInput" value="{{calendarName}}" class="input"></input>
  </view>

  <view class="form-item">
    <view class="label">æ—¥å†æè¿°</view>
    <input placeholder="è¯·è¾“å…¥æ—¥å†æè¿°" bindinput="onCalendarDescInput" value="{{calendarDesc}}" class="input"></input>
  </view>

  <view class="btn" bindtap="createShareCalendar">åˆ›å»ºå…±äº«æ—¥å†</view>

  <!-- æˆ‘çš„å…±äº«æ—¥å† -->
  <view class="list-title" wx:if="{{calendars.length > 0}}">æˆ‘çš„å…±äº«æ—¥å† ({{calendars.length}})</view>
  <view class="list-item" wx:for="{{calendars}}" wx:key="_id">
    <view class="item-content">
      <view class="item-title">{{item.name}}</view>
      <view class="item-desc">{{item.desc}}</view>
      <view class="item-member">æˆå‘˜æ•°ï¼š{{item.members.length}}</view>
    </view>
    <view class="item-actions">
      <button size="mini" bindtap="shareCalendar" data-id="{{item._id}}">åˆ†äº«</button>
    </view>
  </view>
  <view class="empty-tip" wx:else>æš‚æ— å…±äº«æ—¥å†ï¼Œç‚¹å‡»ä¸Šæ–¹åˆ›å»º</view>
</view>
```

#### pages/share/share.wxssï¼ˆå…±äº«æ—¥å†æ ·å¼ï¼‰
```css
.item-desc {
  font-size: 28rpx;
  color: #666;
  margin: 5rpx 0;
}
.item-member {
  font-size: 26rpx;
  color: #999;
}
```

#### pages/share/share.jsï¼ˆå…±äº«æ—¥å†é€»è¾‘ï¼‰
```js
import { createShareCalendar, getShareCalendars } from '../../utils/dbUtil';

Page({
  data: {
    calendarName: '',
    calendarDesc: '',
    calendars: []
  },

  onLoad() {
    this.loadCalendars();
  },

  // åŠ è½½å…±äº«æ—¥å†
  loadCalendars() {
    getShareCalendars().then(res => {
      this.setData({
        calendars: res.data
      });
    }).catch(err => {
      wx.showToast({ title: 'åŠ è½½å…±äº«æ—¥å†å¤±è´¥', icon: 'none' });
      console.error(err);
    });
  },

  // è¾“å…¥æ—¥å†åç§°
  onCalendarNameInput(e) {
    this.setData({ calendarName: e.detail.value });
  },

  // è¾“å…¥æ—¥å†æè¿°
  onCalendarDescInput(e) {
    this.setData({ calendarDesc: e.detail.value });
  },

  // åˆ›å»ºå…±äº«æ—¥å†
  createShareCalendar() {
    const { calendarName, calendarDesc } = this.data;
    if (!calendarName) {
      wx.showToast({ title: 'æ—¥å†åç§°ä¸èƒ½ä¸ºç©º', icon: 'none' });
      return;
    }

    const calendarData = {
      name: calendarName,
      desc: calendarDesc || 'æ— '
    };

    createShareCalendar(calendarData).then(() => {
      wx.showToast({ title: 'åˆ›å»ºå…±äº«æ—¥å†æˆåŠŸ' });
      this.setData({ calendarName: '', calendarDesc: '' });
      this.loadCalendars();
    }).catch(err => {
      wx.showToast({ title: 'åˆ›å»ºå¤±è´¥', icon: 'none' });
      console.error(err);
    });
  },

  // åˆ†äº«æ—¥å†
  shareCalendar(e) {
    const id = e.currentTarget.dataset.id;
    wx.showShareMenu({
      withShareTicket: true,
      menus: ['shareAppMessage', 'shareTimeline']
    });
    this.setData({ shareCalendarId: id });
  },

  // åˆ†äº«ç»™å¥½å‹
  onShareAppMessage() {
    return {
      title: 'é‚€è¯·ä½ åŠ å…¥å…±äº«æ—¥å†',
      path: `/pages/share/share?calendarId=${this.data.shareCalendarId}`,
      imageUrl: '/static/share.png'
    };
  }
});
```

#### pages/share/share.json
```json
{
  "navigationBarTitleText": "å…±äº«æ—¥å†"
}
```

#### pages/tools/tools.wxmlï¼ˆå®ç”¨å°å·¥å…·ï¼‰
```xml
<view class="container">
  <view class="tools-grid">
    <!-- è®¡ç®—å™¨ -->
    <view class="tool-item" bindtap="openCalculator">
      <view class="tool-icon">ğŸ§®</view>
      <view class="tool-name">è®¡ç®—å™¨</view>
    </view>

    <!-- å•ä½æ¢ç®— -->
    <view class="tool-item" bindtap="openUnitConvert">
      <view class="tool-icon">ğŸ“</view>
      <view class="tool-name">å•ä½æ¢ç®—</view>
    </view>

    <!-- äºŒç»´ç ç”Ÿæˆ -->
    <view class="tool-item" bindtap="openQrCode">
      <view class="tool-icon">ğŸŸ¡</view>
      <view class="tool-name">äºŒç»´ç ç”Ÿæˆ</view>
    </view>

    <!-- å°ºå­ -->
    <view class="tool-item" bindtap="openRuler">
      <view class="tool-icon">ğŸ“</view>
      <view class="tool-name">å°ºå­</view>
    </view>

    <!-- å€’è®¡æ—¶ -->
    <view class="tool-item" bindtap="openCountdown">
      <view class="tool-icon">â°</view>
      <view class="tool-name">å€’è®¡æ—¶</view>
    </view>
  </view>

  <!-- å·¥å…·å†…å®¹åŒº -->
  <view class="tool-content" wx:if="{{currentTool === 'calculator'}}">
    <include src="./calculator.wxml"></include>
  </view>

  <view class="tool-content" wx:elif="{{currentTool === 'unit'}}">
    <include src="./unit.wxml"></include>
  </view>

  <view class="tool-content" wx:elif="{{currentTool === 'qr'}}">
    <include src="./qr.wxml"></include>
  </view>

  <view class="tool-content" wx:elif="{{currentTool === 'ruler'}}">
    <include src="./ruler.wxml"></include>
  </view>

  <view class="tool-content" wx:elif="{{currentTool === 'countdown'}}">
    <include src="./countdown.wxml"></include>
  </view>
</view>
```

#### pages/tools/tools.wxssï¼ˆå®ç”¨å°å·¥å…·æ ·å¼ï¼‰
```css
.tools-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 20rpx;
  margin-bottom: 30rpx;
}
.tool-item {
  width: 30%;
  background-color: #fff;
  border-radius: 8rpx;
  padding: 30rpx 0;
  text-align: center;
}
.tool-icon {
  font-size: 60rpx;
  margin-bottom: 10rpx;
}
.tool-name {
  font-size: 28rpx;
}
.tool-content {
  background-color: #fff;
  border-radius: 8rpx;
  padding: 20rpx;
}
```

#### pages/tools/tools.jsï¼ˆå®ç”¨å°å·¥å…·é€»è¾‘ï¼‰
```js
Page({
  data: {
    currentTool: ''
  },

  // æ‰“å¼€è®¡ç®—å™¨
  openCalculator() {
    this.setData({ currentTool: 'calculator' });
  },

  // æ‰“å¼€å•ä½æ¢ç®—
  openUnitConvert() {
    this.setData({ currentTool: 'unit' });
  },

  // æ‰“å¼€äºŒç»´ç ç”Ÿæˆ
  openQrCode() {
    this.setData({ currentTool: 'qr' });
  },

  // æ‰“å¼€å°ºå­
  openRuler() {
    this.setData({ currentTool: 'ruler' });
  },

  // æ‰“å¼€å€’è®¡æ—¶
  openCountdown() {
    this.setData({ currentTool: 'countdown' });
  }
});
```

#### pages/tools/tools.json
```json
{
  "navigationBarTitleText": "å®ç”¨å°å·¥å…·"
}
```

#### pages/mine/mine.wxmlï¼ˆæˆ‘çš„é¡µé¢ï¼‰
```xml
<view class="container">
  <!-- ç”¨æˆ·ä¿¡æ¯ -->
  <view class="user-card">
    <view class="user-avatar">ğŸ‘¤</view>
    <view class="user-info">
      <view class="user-name">ä¸‡å¹´å†ç”¨æˆ·</view>
      <view class="user-score">æˆ‘çš„ç§¯åˆ†ï¼š{{userScore}}</view>
    </view>
  </view>

  <!-- ç­¾åˆ° -->
  <view class="btn {{isSigned ? 'btn-gray' : ''}}" bindtap="signIn" {{isSigned ? 'disabled' : ''}}>
    {{isSigned ? 'ä»Šæ—¥å·²ç­¾åˆ°' : 'ç«‹å³ç­¾åˆ°'}}
  </view>

  <!-- ç»‘å®šé‚®ç®± -->
  <view class="form-item">
    <view class="label">ç»‘å®šé‚®ç®±ï¼ˆç”¨äºé‚®ä»¶æé†’ï¼‰</view>
    <input placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€" bindinput="onEmailInput" value="{{email}}" class="input"></input>
    <view class="btn" bindtap="bindEmail" style="margin-top:10rpx;">ä¿å­˜é‚®ç®±</view>
  </view>

  <!-- åŠŸèƒ½å…¥å£ -->
  <view class="func-list">
    <view class="list-item" bindtap="goToSetting">
      <view class="func-name">è®¾ç½®</view>
      <view class="func-arrow">â†’</view>
    </view>
    <view class="list-item" bindtap="goToHelp">
      <view class="func-name">ä½¿ç”¨å¸®åŠ©</view>
      <view class="func-arrow">â†’</view>
    </view>
    <view class="list-item" bindtap="clearCache">
      <view class="func-name">æ¸…ç†ç¼“å­˜</view>
      <view class="func-arrow">â†’</view>
    </view>
  </view>
</view>
```

#### pages/mine/mine.wxssï¼ˆæˆ‘çš„é¡µé¢æ ·å¼ï¼‰
```css
.user-card {
  background-color: #fff;
  border-radius: 8rpx;
  padding: 30rpx;
  display: flex;
  align-items: center;
  margin-bottom: 20rpx;
}
.user-avatar {
  font-size: 80rpx;
  margin-right: 30rpx;
}
.user-name {
  font-size: 36rpx;
  font-weight: bold;
  margin-bottom: 10rpx;
}
.user-score {
  font-size: 30rpx;
  color: #2F80ED;
}
.func-list {
  margin-top: 30rpx;
}
.func-name {
  font-size: 32rpx;
}
.func-arrow {
  font-size: 28rpx;
  color: #ccc;
}
```

#### pages/mine/mine.jsï¼ˆæˆ‘çš„é¡µé¢é€»è¾‘ï¼‰
```js
import { userSignIn, saveUserInfo, getUserInfo } from '../../utils/dbUtil';

const app = getApp();

Page({
  data: {
    userScore: 0,
    isSigned: false,
    email: ''
  },

  onLoad() {
    this.loadUserInfo();
  },

  // åŠ è½½ç”¨æˆ·ä¿¡æ¯
  loadUserInfo() {
    app.getUserScore(score => {
      this.setData({ userScore: score });
    });

    // æ£€æŸ¥ä»Šæ—¥æ˜¯å¦ç­¾åˆ°
    getUserInfo().then(res => {
      if (res.data.length > 0) {
        const user = res.data[0];
        this.setData({
          isSigned: user.lastSignDate === new Date().toLocaleDateString(),
          email: user.email || ''
        });
      }
    });
  },

  // ç­¾åˆ°
  signIn() {
    if (this.data.isSigned) {
      wx.showToast({ title: 'ä»Šæ—¥å·²ç­¾åˆ°', icon: 'none' });
      return;
    }

    userSignIn().then(res => {
      wx.showToast({ title: res.msg, icon: res.success ? 'success' : 'none' });
      if (res.success) {
        this.setData({
          userScore: res.score,
          isSigned: true
        });
      }
    });
  },

  // è¾“å…¥é‚®ç®±
  onEmailInput(e) {
    this.setData({ email: e.detail.value });
  },

  // ç»‘å®šé‚®ç®±
  bindEmail() {
    const { email } = this.data;
    if (!email) {
      wx.showToast({ title: 'è¯·è¾“å…¥é‚®ç®±åœ°å€', icon: 'none' });
      return;
    }

    // ç®€å•é‚®ç®±æ ¡éªŒ
    const reg = /^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;
    if (!reg.test(email)) {
      wx.showToast({ title: 'é‚®ç®±æ ¼å¼ä¸æ­£ç¡®', icon: 'none' });
      return;
    }

    saveUserInfo({ email }).then(() => {
      wx.showToast({ title: 'é‚®ç®±ç»‘å®šæˆåŠŸ' });
    }).catch(err => {
      wx.showToast({ title: 'ç»‘å®šå¤±è´¥', icon: 'none' });
      console.error(err);
    });
  },

  // å‰å¾€è®¾ç½®
  goToSetting() {
    wx.showToast({ title: 'è®¾ç½®åŠŸèƒ½å¼€å‘ä¸­', icon: 'none' });
  },

  // å‰å¾€å¸®åŠ©
  goToHelp() {
    wx.showToast({ title: 'ä½¿ç”¨å¸®åŠ©å¼€å‘ä¸­', icon: 'none' });
  },

  // æ¸…ç†ç¼“å­˜
  clearCache() {
    wx.showModal({
      title: 'ç¡®è®¤æ¸…ç†',
      content: 'æ˜¯å¦æ¸…ç†å°ç¨‹åºç¼“å­˜ï¼Ÿ',
      success: (res) => {
        if (res.confirm) {
          wx.clearStorage();
          wx.showToast({ title: 'ç¼“å­˜æ¸…ç†æˆåŠŸ' });
        }
      }
    });
  }
});
```

#### pages/mine/mine.json
```json
{
  "navigationBarTitleText": "æˆ‘çš„"
}
```

### å››ã€äº‘å‡½æ•°æ–‡ä»¶ï¼ˆå…¨åŠŸèƒ½ï¼‰
#### cloudfunctions/sendEmail/package.json
```json
{
  "name": "sendEmail",
  "version": "1.0.0",
  "description": "å‘é€é‚®ä»¶äº‘å‡½æ•°",
  "main": "index.js",
  "dependencies": {
    "wx-server-sdk": "latest",
    "nodemailer": "^6.9.13"
  }
}
```

#### cloudfunctions/sendEmail/index.jsï¼ˆé‚®ä»¶å‘é€ï¼‰
```js
// äº‘å‡½æ•°å…¥å£æ–‡ä»¶
const cloud = require('wx-server-sdk');
const nodemailer = require('nodemailer');
cloud.init();

// é…ç½®QQé‚®ç®±SMTPï¼ˆæ›¿æ¢ä¸ºä½ çš„ä¿¡æ¯ï¼ï¼ï¼ï¼‰
const transporter = nodemailer.createTransport({
  host: 'smtp.qq.com',
  port: 465,
  secure: true,
  auth: {
    user: 'ä½ çš„QQé‚®ç®±@qq.com', // æ›¿æ¢ä¸ºä½ çš„QQé‚®ç®±
    pass: 'ä½ çš„QQé‚®ç®±SMTPæˆæƒç ' // æ›¿æ¢ä¸ºä½ çš„æˆæƒç 
  }
});

// äº‘å‡½æ•°å…¥å£å‡½æ•°
exports.main = async (event, context) => {
  const { toEmail, title, content } = event;
  
  // å‚æ•°æ ¡éªŒ
  if (!toEmail || !title || !content) {
    return {
      success: false,
      msg: 'å‚æ•°ç¼ºå¤±ï¼šæ”¶ä»¶äººé‚®ç®±/æ ‡é¢˜/å†…å®¹ä¸èƒ½ä¸ºç©º'
    };
  }

  try {
    // å‘é€é‚®ä»¶
    const info = await transporter.sendMail({
      from: `ä¸‡å¹´å†æé†’ <ä½ çš„QQé‚®ç®±@qq.com>`, // å‘ä»¶äºº
      to: toEmail, // æ”¶ä»¶äºº
      subject: title, // æ ‡é¢˜
      text: content, // çº¯æ–‡æœ¬å†…å®¹
      html: `<div style="padding:20px;line-height:1.6;">
        <h3 style="color:#2F80ED;">${title}</h3>
        <p>${content}</p>
        <p style="color:#999;font-size:12px;">æ­¤é‚®ä»¶ç”±ä¸‡å¹´å†å°ç¨‹åºè‡ªåŠ¨å‘é€ï¼Œè¯·å‹¿å›å¤</p>
      </div>` // HTMLå†…å®¹
    });

    return {
      success: true,
      msg: 'é‚®ä»¶å‘é€æˆåŠŸ',
      messageId: info.messageId
    };
  } catch (error) {
    console.error('é‚®ä»¶å‘é€å¤±è´¥ï¼š', error);
    return {
      success: false,
      msg: 'é‚®ä»¶å‘é€å¤±è´¥ï¼š' + error.message
    };
  }
};
```

#### cloudfunctions/timerRemind/index.jsï¼ˆå®šæ—¶æé†’ï¼‰
```js
// äº‘å‡½æ•°å…¥å£æ–‡ä»¶
const cloud = require('wx-server-sdk');
cloud.init();
const db = cloud.database();

// äº‘å‡½æ•°å…¥å£å‡½æ•°
exports.main = async (event, context) => {
  try {
    // è·å–å½“å‰æ—¶é—´
    const now = new Date();
    const today = `${now.getFullYear()}-${(now.getMonth() +
